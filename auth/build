### Lets convert it to a Habitat plan
###
###

ABCD_HOME=~

SUPPORT_HOME=$ABCD_HOME/bin/support

ABCD_BUILD_HOME=$SUPPORT_HOME/auth

ABCD_AUTH_SERVICE=/etc/systemd/system/abcdauth.service

cd $ABCD_HOME

rm oauth2_proxy*.tar.gz

rm -rf auth

rm -rf oauth2_proxy-*

rm -rf oauth2_proxy.cnf

wget https://github.com/bitly/oauth2_proxy/releases/download/v2.1/oauth2_proxy-2.1.linux-amd64.go1.6.tar.gz

tar -xvf  oauth2_proxy*.tar.gz

mkdir -p auth/bin

openssl req -new -newkey rsa:4096 -days 3650 -nodes -x509 \
    -subj "/C=IN/ST=TN/L=Chennai/O=Cloud/CN=auth.megam.io" \
    -keyout ./auth/auth.megam.io.key  -out ./auth/auth.megam.io.cert

mv oauth2_proxy*/oauth2_proxy ./auth/bin

rm -rf oauth2_proxy-*

wget https://raw.githubusercontent.com/megamsys/support/master/auth/oauth2_proxy.cnf

sudo systemctl stop abcdauth

sudo rm  $ABCD_AUTH_SERVICE

sudo cp $ABCD_BUILD_HOME/abcdauth.service /etc/systemd/system/abcdauth.service

sudo chmod 755 ABCD_AUTH_SERVICE

sudo systemctl start abcdauth.service

echo "==> abcdauth.service is running."
